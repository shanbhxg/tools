<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Tool Management</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./Styles/form.css">
</head>

<body>
    <!-- Navigation Bar -->
    <div class="header_nav p-4 bg-black/60 sm:min-w-[29rem] sm:min-h-[8rem]">
        <div class="headernav_inner_contents">
            <div class="dz-page-header-content-type-text dz-text">RTX Enterprise
                <ul class="nav justify-content-end">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="home.html">Home</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" href="form.html>Add</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="view.html>View</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link "  href="login.html"></a>
                    </li>
                </ul>

            </div>
            <div class="dz-page-header-title headernav_inner_contents2">
                Pratt Whitney Tool Support
            </div>
        </div>
    </div>


    <!-- Body Form -->
    <div class="main_body ">
        <div>

            <div id="authorized" class="hidden">
                <div class="appForm">
                    <form method="POST" class="form" id="dataform">
                        <div id="full">
                            <div id="left" class="">
                                <div class="form-group ">
                                    <label>S/W Application:</label>
                                    <input type="text" id="swApplication" name="swApplication" required>
                                </div>

                                <div class="form-group ">
                                    <label>Team:</label><br>

                                    <input type="checkbox" class="btn-check btn-info team_chkbx" id="EDSI-CORE"
                                        name="installation" value="EDSI-CORE" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="EDSI-CORE">EDSI-CORE</label>

                                    <input type="checkbox" class="btn-check team_chkbx" id="EDSI-EDSC"
                                        name="installation" value="EDSI-EDSC" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="EDSI-EDSC">EDSI-EDSC</label>

                                    <input type="checkbox" class="btn-check team_chkbx" id="ASE,CSE" name="installation"
                                        value="ASE,CSE" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="ASE,CSE">ASE,CSE</label>


                                    <input type="checkbox" class="btn-check btn-info team_chkbx" id="MSEN"
                                        name="installation" value="MSEN" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="MSEN">MSEN</label><br>

                                    <input type="checkbox" class="btn-check team_chkbx" id="EDSI-CE" name="installation"
                                        value="EDSI-CE" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="EDSI-CE">EDSI-CE</label>

                                    <input type="checkbox" class="btn-check btn-info team_chkbx" id="ASE,ESTO"
                                        name="installation" value="ASE,ESTO" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="ASE,ESTO">ASE,ESTO</label>

                                    <input type="checkbox" class="btn-check team_chkbx" id="ASE" name="installation"
                                        value="ASE" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="ASE">ASE</label>

                                    <input type="checkbox" class="btn-check btn-info team_chkbx" id="ENDO"
                                        name="installation" value="ENDO" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="ENDO">ENDO</label>

                                    <input type="checkbox" class="btn-check team_chkbx" id="ESTO" name="installation"
                                        value="ESTO" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="ESTO">ESTO</label>



                                </div>

                                <div class="form-group">
                                    <label>Domain:</label><br>
                                    <input type="checkbox" class="btn-check btn-info domain_chkbx" id="Aero-Thermal"
                                        name="domain" value="Aero-Thermal" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx"
                                        for="Aero-Thermal">Aero-Thermal</label>

                                    <input type="checkbox" class="btn-check domain_chkbx"
                                        id="Data-Science and Analytics" name="domain" value="Data-Science and Analytics"
                                        autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx"
                                        for="Data-Science and Analytics">Data-Science and Analytics</label>

                                    <input type="checkbox" class="btn-check domain_chkbx" id="Methods Development"
                                        name="domain" value="Methods Development" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Methods Development">Methods
                                        Development</label>


                                    <input type="checkbox" class="btn-check btn-info domain_chkbx" id="Web Development"
                                        name="domain" value="Web Development" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Web Development">Web
                                        Development</label><br>

                                    <input type="checkbox" class="btn-check domain_chkbx" id="Performance" name="domain"
                                        value="Performance" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Performance">Performance</label>

                                    <input type="checkbox" class="btn-check btn-info domain_chkbx" id="Fleet Analytics"
                                        name="domain" value="Fleet Analytics" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Fleet Analytics">Fleet
                                        Analytics</label>

                                    <input type="checkbox" class="btn-check btn-info domain_chkbx" id="Systems Design"
                                        name="domain" value="Systems Design" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Systems Design">Systems
                                        Design</label>

                                    <input type="checkbox" class="btn-check domain_chkbx" id="Structural Design"
                                        name="domain" value="Structural Design" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Structural Design">Structural
                                        Design</label>

                                    <input type="checkbox" class="btn-check domain_chkbx" id="Systems Engineering"
                                        name="domain" value="Systems Engineering" autocomplete="off">
                                    <label class="btn btn-outline-secondary chkbx" for="Systems Engineering">Systems
                                        Engineering</label>
                                </div>



                                <div class="form-group">
                                    <label>Need Date:</label>
                                    <input type="date" id="needDate" name="needDate" required>
                                </div>

                                <div class="form-group">
                                    <label>Application:</label>
                                    <input type="text" id="Application" name="Application" required>
                                </div>

                                <div class="form-group">
                                    <label>Purpose:</label>
                                    <input type="text" id="purpose" name="purpose" required>
                                </div>
                            </div>


                            <div id="right" class="">
                                <div class="form-group">
                                    <label>Version:</label>
                                    <input type="text" id="version" name="version" required>
                                </div>

                                <div class="form-group">
                                    <label>Software Type:</label><br>
                                    <select id="swType" name="swType" required>
                                        <option value="">Select Software Type</option>
                                        <option value="Commercial">Commercial</option>
                                        <option value="Open Source">Open Source</option>
                                        <option value="PW Internal">PW Internal</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>S/W Installation Type:</label><br>

                                    <input type="checkbox" class="btn-check chkbx sw_install_chkbx" id="catalog"
                                        name="swInstallation" value="Catalog" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="catalog">Catalog</label>

                                    <input type="checkbox" class="btn-check btn-info chkbx sw_install_chkbx"
                                        id="nonCatalog" name="swInstallation" value="Non-Catalog" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="nonCatalog">Non-Catalog</label>

                                </div>

                                <div class="form-group">
                                    <label>Installation:</label><br>
                                    <input type="checkbox" class="btn-check chkbx installation_chkbx" id="eVDI"
                                        name="installation" autocomplete="off" value="eVDI">
                                    <label class="btn btn-outline-secondary" for="eVDI">eVDI</label>

                                    <input type="checkbox" class="btn-check btn-info chkbx installation_chkbx" id="MWS"
                                        name="installation" value="MWS" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="MWS">MWS</label>

                                </div>

                                <div class="form-group">
                                    <label>License:</label><br>

                                    <input type="checkbox" class="btn-check chkbx License_chkbx" id="global"
                                        name="license" value="Global" name="installation" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="global">Global</label>

                                    <input type="checkbox" class="btn-check btn-info chkbx License_chkbx" id="local"
                                        name="license" value="Local" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="local">Local</label>

                                    <input type="checkbox" class="btn-check chkbx License_chkbx" id="global/local"
                                        name="license" value="Global/Local" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="global/local">Global/Local</label>

                                    <input type="checkbox" class="btn-check btn-info chkbx License_chkbx" id="iecAccess"
                                        name="license" value="IEC Access" autocomplete="off">
                                    <label class="btn btn-outline-secondary" for="iecAccess">IEC Access</label>

                                </div>

                                <div class="form-group">

                                    <div class="mb-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">Comments:</label>
                                        <textarea class="form-control" id="comments" rows="4"
                                            placeholder="Additional comments"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary btn_submit text-center">Submit</button>
                </div>

                </form>

            </div>

            <div id="unauthorized" class="hidden ">
                <div class="login-box-denied">
                    <h2>Access Denied for Addition of Tools</h2>
                    <form onsubmit="return validateForm()" method="post" >
                        
                        <a id="deniedmainBtn">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                            Back
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>

        //Give Access For Only Super Users - hardCoded

        var authorizedDiv = document.getElementById("authorized");
        var unauthorizedDiv = document.getElementById("unauthorized");

        if (login_username === "F337751") {
            authorizedDiv.classList.remove("hidden");
            unauthorizedDiv.classList.add("hidden");
        } else {
            authorizedDiv.classList.add("hidden");
            unauthorizedDiv.classList.remove("hidden");
        }

        //Passing back the UserID to home on Click of Button - "Back"
        const back = document.getElementById("deniedmainBtn");
        back.href = `home.html?login_username=${login_username}`;



        var fs = require('fs');
        const path = require('path');

        document.getElementById('dataform').addEventListener('submit', (event) => {
            event.preventDefault();

            const SW_App = document.getElementById('swApplication').value;
            //const domain = document.getElementById('domain').value;
            const need_date = document.getElementById('needDate').value;
            const application = document.getElementById('Application').value;
            const purpose = document.getElementById('purpose').value;
            const version = document.getElementById('version').value;
            const SW_Type = document.getElementById('swType').value;
            const comments = document.getElementById('comments').value;

            var domain_checkedValue = "";
            var domain_inputElements = document.getElementsByClassName('domain_chkbx');
            for (var i = 0; domain_inputElements[i]; ++i) {
                if (domain_inputElements[i].checked) {
                    domain_checkedValue += " " + domain_inputElements[i].value;
                }
            }

            var team_checkedValue = "";
            var team_inputElements = document.getElementsByClassName('team_chkbx');
            for (var i = 0; team_inputElements[i]; ++i) {
                if (team_inputElements[i].checked) {
                    team_checkedValue += " " + team_inputElements[i].value;
                }
            }

            var sw_install_checkedValue = "";
            var sw_install_inputElements = document.getElementsByClassName('sw_install_chkbx');
            for (var i = 0; sw_install_inputElements[i]; ++i) {
                if (sw_install_inputElements[i].checked) {
                    sw_install_checkedValue += " " + sw_install_inputElements[i].value;
                }
            }

            var install_checkedValue = "";
            var install_inputElements = document.getElementsByClassName('installation_chkbx');
            for (var i = 0; install_inputElements[i]; ++i) {
                if (install_inputElements[i].checked) {
                    install_checkedValue += " " + install_inputElements[i].value;
                }
            }

            var License_checkedValue = "";
            var License_inputElements = document.getElementsByClassName('License_chkbx');
            for (var i = 0; License_inputElements[i]; ++i) {
                if (License_inputElements[i].checked) {
                    License_checkedValue += " " + License_inputElements[i].value;
                }
            }


            /*if (SW_App.trim() === '' || domain_checkedValue.trim() === '') {
                Application
                alert('Please fill out both location and data fields.');
                return;
            }f
            */
            const newData = {
                name: SW_App,
                fields: {
                    Name: SW_App,
                    Team: team_checkedValue,
                    Domain: domain_checkedValue,
                    "Need Date": need_date,
                    Application: application,
                    Purpose: purpose,
                    Version: version,
                    "S/W Type": SW_Type,
                    Installation: install_checkedValue,
                    License: License_checkedValue,
                    Comments: comments
                }
            };

            const filePath = path.join("\\\\pinbaf01.pwintl.us\\IEC\\Data_Analytics_Methods\\WebDevelopment\\Tool&Software", 'data.json');

            fs.readFile(filePath, 'utf-8', (err, fileData) => {
                if (err) {
                    alert('Error reading file:', err);
                    return;
                }
                let json = [];
                if (fileData) {
                    try {
                        json = JSON.parse(fileData);
                        for (let i = 0; i < json.length; i++) {
                            const category = json[i];
                            for (let j = 0; j < category.softwareTools.length; j++) {
                                const softwareTool = category.softwareTools[j];
                                if (softwareTool.name === SW_App) {
                                    alert('Application Already Exists - ' + SW_App);
                                    return;
                                }
                            }
                        }
                    } catch (parseError) {
                        alert('Error parsing JSON:', parseError);
                        return;
                    }
                }

                let categoryIndex = json.findIndex(category => category.name === domain_checkedValue);
                if (categoryIndex === -1) {
                    categoryIndex = json.length;
                    json.push({
                        name: domain_checkedValue,
                        softwareTools: []
                    });
                }


                json[categoryIndex].softwareTools.push(newData);

                fs.writeFile(filePath, JSON.stringify(json, null, 2), 'utf-8', (writeErr) => {
                    if (writeErr) {
                        alert('Error writing to file:', writeErr);
                        return;
                    }
                    alert('Data submitted successfully!');
                });
            });
        });





    </script>


</body>

</html>
